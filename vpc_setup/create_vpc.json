{
    "AWSTemplateFormatVersion" : "2010-09-09",
    "Parameters": {
        "TestName": {
            "Description": "What are you testing?",
            "Type": "String"
        },
        "vpc_cidr": {
            "Description": "CIDR Range for VPC",
            "Type": "String",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "Default": "10.0.0.0/18"
        }
    },
    "Resources" : {
       "Vpc" : {
          "Type" : "AWS::EC2::VPC",
          "Properties" : {
             "CidrBlock" : {"Ref" : "vpc_cidr"},
             "EnableDnsSupport" : "true",
             "EnableDnsHostnames" : "true",
             "Tags" : [ 
                {"Key" : "Name", "Value" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "VPC"]]}} 
             ]
          }
       },
       "InternetGateway" : {
          "Type" : "AWS::EC2::InternetGateway",
          "Properties" : {
            "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "IGW"]]}}]
          }
       },
       "RouteTable" : {
          "Type" : "AWS::EC2::RouteTable",
          "Properties" : {
             "VpcId" : { "Ref" : "Vpc" },
             "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "RouteTable"]]}} ]
          }
       },
       "AttachGateway" : {
          "Type" : "AWS::EC2::VPCGatewayAttachment",
          "Properties" : {
             "VpcId" : { "Ref" : "Vpc" },
             "InternetGatewayId" : { "Ref" : "InternetGateway" }
           }
       },
       "IGWRoute" : {
          "Type" : "AWS::EC2::Route",
          "Properties" : {
             "RouteTableId" : { "Ref" : "RouteTable" },
             "DestinationCidrBlock" : "0.0.0.0/0",
             "GatewayId" : { "Ref" : "InternetGateway" }
          }
       },
       "PublicSubnet" : {
          "Type" : "AWS::EC2::Subnet",
          "Properties" : {
             "AvailabilityZone" : "us-west-2a",
             "CidrBlock" : "10.0.1.0/24",
             "VpcId" : {"Ref" : "Vpc"},
             "Tags" : [
                {"Key" : "Name", "Value" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "Public-Subnet"]]}}
             ]
          }
       },
       "PrivateSubnet" : {
          "Type" : "AWS::EC2::Subnet",
          "Properties" : {
             "AvailabilityZone" : "us-west-2b",
             "CidrBlock" : "10.0.2.0/24",
             "VpcId" : {"Ref" : "Vpc"},
             "Tags" : [
                {"Key" : "Name", "Value" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "Private-Subnet"]]}}
             ]
          }
       },
       
       "PublicSubnetRouteTableAssociation" : {
          "Type" : "AWS::EC2::SubnetRouteTableAssociation",
          "Properties" : {
             "SubnetId" : { "Ref" : "PublicSubnet" },
             "RouteTableId" : { "Ref" : "RouteTable" }
          }
       }
 
    },
    
    "Outputs" : {
       "VpcID" : {
          "Description" : "The ID of VPC",
          "Value" : {"Ref" : "Vpc"},
          "Export" : {"Name" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "VPC-ID"]]}}
       },
       "PublicSubnetID" : {
          "Description" : "The ID of PublicSubnet",
          "Value" : {"Ref" : "PublicSubnet"},
          "Export" : {"Name" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "Public-Subnet-ID"]]}}
       },
       "PrivateSubnetID" : {
          "Description" : "The ID of PrivateSubnet",
          "Value" : {"Ref" : "PrivateSubnet"},
          "Export" : {"Name" : {"Fn::Join" : ["-", [{"Ref" : "TestName"}, "Private-Subnet-ID"]]}}
       }
    }
 }